<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VB Daily â€” Reactions Infographic</title>
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body>
    <header>
      <h1>VB Daily â€” Reader Reactions</h1>
      <p class="muted">Infographic from the survey export. All in-browser.</p>
    </header>

    <section class="controls">
      <div class="control">
        <label for="file">Upload CSV</label>
        <input type="file" id="file" accept=".csv,text/csv" />
      </div>
      <div class="control">
        <label>Layout</label>
        <label class="toggle"><input type="checkbox" id="editLayout"> Edit layout</label>
      </div>
      <div class="control">
        <label>Audience</label>
        <div>
          <label class="toggle"><input type="radio" name="audMode" value="all" checked> All</label>
          <label class="toggle"><input type="radio" name="audMode" value="new"> New</label>
          <label class="toggle"><input type="radio" name="audMode" value="returning"> Returning</label>
        </div>
      </div>
      <div class="control">
        <label>Outlier Mode</label>
        <select id="outlierMode">
          <option value="zscore" selected>Z-score</option>
          <option value="mad">MAD (robust)</option>
        </select>
      </div>
      <div class="control">
        <label>&nbsp;</label>
        <label class="toggle"><input type="checkbox" id="showBands" checked> Show control bands</label>
      </div>
      <div class="control">
        <label>Export</label>
        <div class="btn-row">
          <button id="exportPdf" class="button primary">Export PDF</button>
          <button id="exportPngSheet" class="button">PNG Sheet</button>
          <button id="exportJson" class="button">Analysis JSON</button>
        </div>
      </div>
    </section>

    <section class="summary">
      <div class="card"><div class="label">Total Responses</div><div class="value" id="mTotal">â€”</div></div>
      <div class="card"><div class="label">Window (UTC)</div><div class="value" id="mWindow">â€”</div></div>
      <div class="card"><div class="label">Unique IDs</div><div class="value" id="mUnique">â€”</div></div>
      <div class="card"><div class="label">Repeaters</div><div class="value" id="mRepeaters">â€”</div></div>
    </section>

    <section class="layout charts">
      <div class="panel">
        <div class="panel-head">
          <h2>Emoji Distribution Over Time</h2>
          <div class="legend" id="legendEmoji"></div>
        </div>
        <div class="toolbar"><label class="toggle"><input type="radio" name="stackMode" value="counts" checked> Counts</label> <label class="toggle"><input type="radio" name="stackMode" value="share"> Share %</label></div>
        <canvas id="emojiStacked" height="360"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Engagement Index</h2>
          <div class="legend" id="legendSentiment">Wow +1, Curious 0, Boring âˆ’1</div>
        </div>
        <canvas id="sentimentLine" height="360"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Flip Rate Over Time</h2>
          <div class="legend">Share of returning IDs switching emoji vs prior active day</div>
        </div>
        <canvas id="flipRateLine" height="320"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Outlier Days</h2>
          <div class="legend">Z-score based spikes/dips in index and emoji mix</div>
        </div>
        <div id="outliersList" class="table-container"></div>
      </div>
      <div class="panel full-span">
        <div class="panel-head">
          <h2>Calendar Heatmap</h2>
          <div class="legend">Daily Wow share (darker green = higher)</div>
        </div>
        <canvas id="calendarHeatmap" height="260"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Daily Mix â€” Ternary</h2>
          <div class="legend">Each point is a day; position encodes Wow/Curious/Boring mix, size = total responses.</div>
        </div>
        <canvas id="ternaryMix" height="420"></canvas>
      </div>
      <div class="panel full-span">
        <div class="panel-head">
          <h2>Weekday Patterns (PT)</h2>
          <div class="legend">Monâ€“Fri â€¢ Hour vs day â€¢ Color = count (selected) â€¢ Label = responses</div>
          <div class="toolbar" style="margin:0">
            <label class="toggle"><input type="radio" name="wkdMetric" value="total" checked> Total</label>
            <label class="toggle"><input type="radio" name="wkdMetric" value="wow"> ðŸ¤¯ Wow</label>
            <label class="toggle"><input type="radio" name="wkdMetric" value="curious"> ðŸ¤” Curious</label>
            <label class="toggle"><input type="radio" name="wkdMetric" value="boring"> ðŸ˜´ Boring</label>
          </div>
        </div>
        <canvas id="dowHeatmap" height="520"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Top Returning Network IDs</h2>
          <div class="legend" id="legendIDs"></div>
        </div>
        <canvas id="topIDsBar" height="420"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Emoji Transitions (Returning IDs)</h2>
          <div class="legend">Probability of next active-day emoji given current</div>
        </div>
        <canvas id="transitionsMatrix" height="260"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Sentiment Insights</h2>
          <div class="legend">Peaks, averages, and recent trend for ðŸ¤¯/ðŸ¤”/ðŸ˜´</div>
        </div>
        <div id="sentimentInsights" class="insights-grid"></div>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>First-Sentiment Cohorts</h2>
          <div class="legend">Retention by first emoji at D+1 / D+3 / D+7</div>
        </div>
        <canvas id="cohortBars" height="240"></canvas>
      </div>
      <div class="panel full-span">
        <div class="panel-head">
          <h2>Day Details</h2>
          <div class="legend">Click any calendar day to drill in</div>
        </div>
        <div id="dayDrilldown" class="table-container"></div>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Retention Overview</h2>
          <div class="legend">Share of first-seen IDs returning within 1/3/7 days</div>
        </div>
        <canvas id="retentionBars" height="180"></canvas>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Top 3 Returning Clickers â€” Stories</h2>
          <div class="legend">Condensed journey and reaction mix</div>
        </div>
        <div id="storiesContainer" class="stories-grid"></div>
      </div>
      <div class="panel">
        <div class="panel-head">
          <h2>Returning Rate Over Time</h2>
          <div class="legend">Share of daily responses from previously seen IDs</div>
        </div>
        <canvas id="returningRateLine" height="360"></canvas>
      </div>
    </section>

    <section class="layout">
      <div class="panel">
        <h2>Recent Responses</h2>
        <div id="preview" class="table-container"></div>
      </div>
    </section>

    <footer>
      <div class="muted">All processing happens in your browser. No uploads.</div>
    </footer>

    <script src="src/app.js"></script>
  </body>
  </html>
